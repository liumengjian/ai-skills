# 三、项目页面结构

## 11. 菜单注册规范

### 概述

- **菜单路由**：开发阶段菜单路由无需手动配置，路由会根据页面目录结构自动生成
- **菜单注册**：发布到底座中后，**必须手动注册菜单**，否则底座无法识别应用有哪些菜单服务，无法正常使用
- **按钮权限**：按钮权限需要手动注册，开发阶段和线上环境都需要在平台中注册按钮权限，否则无法使用按钮权限控制功能

### 重要说明

- **注册权限**：只有超级管理员可以注册菜单和按钮权限
- **注册位置**：菜单和按钮权限注册只能在线上平台完成，开发阶段需要在开发环境进行注册
- **注册顺序**：必须先注册菜单，才能注册按钮权限（按钮权限必须挂载在菜单下）

---

## 开发环境菜单和按钮权限注册步骤

### 1. 登录开发环境

- **开发环境地址**：http://10.43.250.65/login/client/72cf4f659dc54dcfaeecd32eabf483b5
- **账号**：`superadmin`
- **密码**：`aa0000`

### 2. 进入菜单管理

1. 登录成功后，点击底座右上角 **"全部服务"**
2. 找到 **系统设置 > 菜单管理**
3. 在搜索框中搜索对应的应用名称

**⚠️ 注意事项**：
- 开发之前，后端人员通常会提前注册好应用
- 如果搜索不到应用，可能是应用尚未注册，需要先联系后端人员注册应用

### 3. 添加菜单

1. 找到对应应用后，点击应用右侧的 **"添加"** 按钮
2. 选择类型为 **"菜单"**
3. 在表单中填写 **"资源路径"**，格式为：`appIdentifier/container/xxx`
   - `appIdentifier`：应用的唯一标识符（在 `jjb.config.js` 中配置）
   - `xxx`：页面名称（对应 `src/pages/Container/` 下的页面文件夹名称）
   - **示例**：如果应用标识符为 `myApp`，页面文件夹为 `UserList`，则资源路径为：`myApp/container/UserList`

### 4. 启用菜单

- 菜单添加完成后，**必须开启状态**，否则菜单无效，无法在底座中显示和使用

---

## 按钮权限注册步骤

### 前置条件

- **重要**：必须先注册菜单，才能注册按钮权限
- 按钮权限必须挂载在对应的菜单下

### 1. 添加按钮权限

1. 在菜单管理页面，找到已注册的菜单
2. 点击菜单右侧的 **"添加"** 按钮
3. 选择类型为 **"按钮"**
4. 在表单中依次填写以下字段：
   - **按钮名称**：按钮的显示名称（如：新增、编辑、删除等）
   - **按钮key**：按钮的唯一标识，格式为：`appIdentifier_pageName_btnName`
     - `appIdentifier`：应用的唯一标识符
     - `pageName`：页面名称（对应 `src/pages/Container/` 下的页面文件夹名称）
     - `btnName`：按钮名称（通常使用小驼峰命名，如：add、edit、delete）
     - **示例**：如果应用标识符为 `myApp`，页面为 `UserList`，按钮为新增，则按钮key为：`myApp_UserList_add`
   - **资源路径**：默认为 `*`（通常不需要修改）

### 2. 启用按钮权限

- 按钮权限添加完成后，**必须开启状态**，否则按钮权限无效，无法在权限控制中使用

---

## 开发阶段按钮权限使用建议

### 取反判断方式

在开发阶段，如果按钮权限尚未注册，可以使用取反判断的方式临时显示按钮，但必须添加待办注释提醒后续需要注册按钮权限。

**代码示例**：

```javascript
// TODO: 待注册按钮权限后，改为 permission('add') 判断
{!permission('add') && <Button>新增</Button>}
```

**说明**：
- 开发阶段：使用 `!permission('add')` 取反判断，按钮会显示（因为权限未注册，返回 `false`，取反后为 `true`）
- 上线前：必须注册按钮权限，并将代码改为 `permission('add')` 正常判断
- 待办注释：必须添加 `TODO` 注释，提醒后续需要注册按钮权限并修改代码

**⚠️ 重要提醒**：
- 此方式仅用于开发阶段临时使用
- 上线前必须完成按钮权限注册并修改为正常判断
- 禁止在生产环境使用取反判断

---

## 上线后注意事项

### 环境同步

- **重要**：开发环境注册的菜单和按钮权限不会自动同步到其他环境
- **操作要求**：上线后必须通知后端人员，将应用菜单和按钮权限注册同步到线上环境
- **影响**：如果未同步，其他环境将无法使用应用菜单和按钮权限控制功能

---

## 注册检查清单

### 菜单注册

- [ ] 应用已在平台注册（由后端人员完成）
- [ ] 已登录开发环境菜单管理页面
- [ ] 已添加所有需要使用的菜单
- [ ] 资源路径格式正确：`appIdentifier/container/xxx`
- [ ] 菜单状态已开启

### 按钮权限注册

- [ ] 已先完成菜单注册
- [ ] 已为每个菜单添加所需的按钮权限
- [ ] 按钮key格式正确（参考上方格式说明）
- [ ] 资源路径已设置为 `*`（默认值）
- [ ] 按钮权限状态已开启

### 上线同步

- [ ] 上线后已通知后端人员同步菜单到线上环境
- [ ] 上线后已通知后端人员同步按钮权限到线上环境