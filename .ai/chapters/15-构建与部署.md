# 十五、构建与部署

### 1. 应用推送

- **推送命令**：使用 `jjb-cmd push java <环境>` 命令将前端应用推送到后端 Java 项目仓库

  - 命令格式：`jjb-cmd push java <环境>`

  - 环境配置：环境参数来源于 `jjb.config.js` 文件中的 `environment` 配置项

- **后端仓库配置**：

  - **配置来源**：后端仓库相关配置来源于根目录 `jjb.config.js` 文件

  - **配置项说明**：

    - **javaGit**：后端 Java 项目的 Git 仓库地址，用于推送前端资源

    - **javaGitName**：后端 Java 项目的仓库名称，用于标识目标仓库

    - **javaGitBranch**：后端 Java 项目的分支名称，不同环境对应不同的分支

    - **⚠️ 重要提示**：确保已取得后端仓库 Git 权限，否则推送失败

  - **配置结构**：

    ```javascript
    // jjb.config.js
    {
      // 应用后端 Git 地址，部署上线需要
      javaGit: 'http://XX.git',
      // 应用后端仓库名称，部署上线需要
      javaGitName: 'XX',
      // 环境配置
      environment: {
        development: {
          // 应用后端分支名称，部署上线需要
          javaGitBranch: 'XX',
          // 接口服务地址
          API_HOST: 'XX',
        },
        production: {
          // 应用后端分支名称，部署上线需要
          javaGitBranch: 'XX',
          // 接口服务地址
          API_HOST: 'XX',
        },
      },
    }
    ```

  - **环境与分支映射**：

    - 推送命令会根据指定的环境参数，自动从 `environment` 配置中获取对应的 `javaGitBranch` 分支名称

    - 例如：`jjb-cmd push java development` 会推送到 `development` 环境配置中指定的 `javaGitBranch` 分支

- **应用推送机制**：

  - **推送流程**：应用推送是将前端打包生成的 `dist` 文件夹推送到后端 Java 项目仓库，然后与后端代码一起部署

  - **部署方式**：后端 Java 项目使用文件服务输出前端资源，而非传统的 Nginx 静态文件服务

  - **工作流程**：

    1. 前端项目执行构建命令，生成 `dist` 文件夹

    2. 执行 `jjb-cmd push java <环境>` 命令，系统会根据环境参数从 `jjb.config.js` 中读取对应的后端 Git 地址、仓库名称和分支名称

    3. 将 `dist` 文件夹推送到对应的后端 Java 项目仓库的指定分支

    4. 后端 Java 项目将前端资源集成到项目中，通过文件服务提供前端资源访问

    5. 后端项目部署时，前端资源与后端代码一起部署到服务器

- **使用说明**：

  - 执行推送前需确认目标环境配置正确

  - 确保前端项目已完成构建，`dist` 文件夹存在且内容正确

  - 具体环境选择需咨询开发者
